var SpinningWheel={cellHeight:44,friction:0.003,slotData:[],handleEvent:function(e){if(e.type=='touchstart'){this.lockScreen(e);if(e.currentTarget.id=='sw-cancel'||e.currentTarget.id=='sw-done'){this.tapDown(e)}else if(e.currentTarget.id=='sw-frame'){this.scrollStart(e)}}else if(e.type=='touchmove'){this.lockScreen(e);if(e.currentTarget.id=='sw-cancel'||e.currentTarget.id=='sw-done'){this.tapCancel(e)}else if(e.currentTarget.id=='sw-frame'){this.scrollMove(e)}}else if(e.type=='touchend'){if(e.currentTarget.id=='sw-cancel'||e.currentTarget.id=='sw-done'){this.tapUp(e)}else if(e.currentTarget.id=='sw-frame'){this.scrollEnd(e)}}else if(e.type=='webkitTransitionEnd'){if(e.target.id=='sw-wrapper'){this.destroy()}else{this.backWithinBoundaries(e)}}else if(e.type=='orientationchange'){this.onOrientationChange(e)}else if(e.type=='scroll'){this.onScroll(e)}},onOrientationChange:function(e){window.scrollTo(0,0);this.swWrapper.style.top=window.innerHeight+window.pageYOffset+'px';this.calculateSlotsWidth()},onScroll:function(e){this.swWrapper.style.top=window.innerHeight+window.pageYOffset+'px'},lockScreen:function(e){e.preventDefault();e.stopPropagation()},reset:function(){this.slotEl=[];this.activeSlot=null;this.swWrapper=undefined;this.swSlotWrapper=undefined;this.swSlots=undefined;this.swFrame=undefined},calculateSlotsWidth:function(){var a=this.swSlots.getElementsByTagName('div');for(var i=0;i<a.length;i+=1){this.slotEl[i].slotWidth=a[i].offsetWidth}},create:function(){var i,l,out,ul,div;this.reset();div=document.createElement('div');div.id='sw-wrapper';div.style.top=window.innerHeight+window.pageYOffset+'px';div.style.webkitTransitionProperty='-webkit-transform';div.innerHTML='<div id="sw-header"><div id="sw-cancel">Cancel</'+'div><div id="sw-done">Done</'+'div></'+'div><div id="sw-slots-wrapper"><div id="sw-slots"></'+'div></'+'div><div id="sw-frame"></'+'div>';document.body.appendChild(div);this.swWrapper=div;this.swSlotWrapper=document.getElementById('sw-slots-wrapper');this.swSlots=document.getElementById('sw-slots');this.swFrame=document.getElementById('sw-frame');for(l=0;l<this.slotData.length;l+=1){ul=document.createElement('ul');out='';for(i in this.slotData[l].values){out+='<li>'+this.slotData[l].values[i]+'<'+'/li>'}ul.innerHTML=out;div=document.createElement('div');div.className=this.slotData[l].style;div.appendChild(ul);this.swSlots.appendChild(div);ul.slotPosition=l;ul.slotYPosition=0;ul.slotWidth=0;ul.slotMaxScroll=this.swSlotWrapper.clientHeight-ul.clientHeight-86;ul.style.webkitTransitionTimingFunction='cubic-bezier(0, 0, 0.2, 1)';this.slotEl.push(ul);if(this.slotData[l].defaultValue){this.scrollToValue(l,this.slotData[l].defaultValue)}}this.calculateSlotsWidth();document.addEventListener('touchstart',this,false);document.addEventListener('touchmove',this,false);window.addEventListener('orientationchange',this,true);window.addEventListener('scroll',this,true);document.getElementById('sw-cancel').addEventListener('touchstart',this,false);document.getElementById('sw-done').addEventListener('touchstart',this,false);this.swFrame.addEventListener('touchstart',this,false)},open:function(){this.create();this.swWrapper.style.webkitTransitionTimingFunction='ease-out';this.swWrapper.style.webkitTransitionDuration='400ms';this.swWrapper.style.webkitTransform='translate3d(0, -260px, 0)'},destroy:function(){this.swWrapper.removeEventListener('webkitTransitionEnd',this,false);this.swFrame.removeEventListener('touchstart',this,false);document.getElementById('sw-cancel').removeEventListener('touchstart',this,false);document.getElementById('sw-done').removeEventListener('touchstart',this,false);document.removeEventListener('touchstart',this,false);document.removeEventListener('touchmove',this,false);window.removeEventListener('orientationchange',this,true);window.removeEventListener('scroll',this,true);this.slotData=[];this.cancelAction=function(){return false};this.cancelDone=function(){return true};this.reset();document.body.removeChild(document.getElementById('sw-wrapper'))},close:function(){this.swWrapper.style.webkitTransitionTimingFunction='ease-in';this.swWrapper.style.webkitTransitionDuration='400ms';this.swWrapper.style.webkitTransform='translate3d(0, 0, 0)';this.swWrapper.addEventListener('webkitTransitionEnd',this,false)},addSlot:function(a,b,c){if(!b){b=''}b=b.split(' ');for(var i=0;i<b.length;i+=1){b[i]='sw-'+b[i]}b=b.join(' ');var d={'values':a,'style':b,'defaultValue':c};this.slotData.push(d)},getSelectedValues:function(){var a,count,i,l,keys=[],values=[];for(i in this.slotEl){this.slotEl[i].removeEventListener('webkitTransitionEnd',this,false);this.slotEl[i].style.webkitTransitionDuration='0';if(this.slotEl[i].slotYPosition>0){this.setPosition(i,0)}else if(this.slotEl[i].slotYPosition<this.slotEl[i].slotMaxScroll){this.setPosition(i,this.slotEl[i].slotMaxScroll)}a=-Math.round(this.slotEl[i].slotYPosition/this.cellHeight);count=0;for(l in this.slotData[i].values){if(count==a){keys.push(l);values.push(this.slotData[i].values[l]);break}count+=1}}return{'keys':keys,'values':values}},setPosition:function(a,b){this.slotEl[a].slotYPosition=b;this.slotEl[a].style.webkitTransform='translate3d(0, '+b+'px, 0)'},scrollStart:function(e){var a=e.targetTouches[0].clientX-this.swSlots.offsetLeft;var b=0;for(var i=0;i<this.slotEl.length;i+=1){b+=this.slotEl[i].slotWidth;if(a<b){this.activeSlot=i;break}}if(this.slotData[this.activeSlot].style.match('readonly')){this.swFrame.removeEventListener('touchmove',this,false);this.swFrame.removeEventListener('touchend',this,false);return false}this.slotEl[this.activeSlot].removeEventListener('webkitTransitionEnd',this,false);this.slotEl[this.activeSlot].style.webkitTransitionDuration='0';var c=window.getComputedStyle(this.slotEl[this.activeSlot]).webkitTransform;c=new WebKitCSSMatrix(c).m42;if(c!=this.slotEl[this.activeSlot].slotYPosition){this.setPosition(this.activeSlot,c)}this.startY=e.targetTouches[0].clientY;this.scrollStartY=this.slotEl[this.activeSlot].slotYPosition;this.scrollStartTime=e.timeStamp;this.swFrame.addEventListener('touchmove',this,false);this.swFrame.addEventListener('touchend',this,false);return true},scrollMove:function(e){var a=e.targetTouches[0].clientY-this.startY;if(this.slotEl[this.activeSlot].slotYPosition>0||this.slotEl[this.activeSlot].slotYPosition<this.slotEl[this.activeSlot].slotMaxScroll){a/=2}this.setPosition(this.activeSlot,this.slotEl[this.activeSlot].slotYPosition+a);this.startY=e.targetTouches[0].clientY;if(e.timeStamp-this.scrollStartTime>80){this.scrollStartY=this.slotEl[this.activeSlot].slotYPosition;this.scrollStartTime=e.timeStamp}},scrollEnd:function(e){this.swFrame.removeEventListener('touchmove',this,false);this.swFrame.removeEventListener('touchend',this,false);if(this.slotEl[this.activeSlot].slotYPosition>0||this.slotEl[this.activeSlot].slotYPosition<this.slotEl[this.activeSlot].slotMaxScroll){this.scrollTo(this.activeSlot,this.slotEl[this.activeSlot].slotYPosition>0?0:this.slotEl[this.activeSlot].slotMaxScroll);return false}var a=this.slotEl[this.activeSlot].slotYPosition-this.scrollStartY;if(a<this.cellHeight/1.5&&a>-this.cellHeight/1.5){if(this.slotEl[this.activeSlot].slotYPosition%this.cellHeight){this.scrollTo(this.activeSlot,Math.round(this.slotEl[this.activeSlot].slotYPosition/this.cellHeight)*this.cellHeight,'100ms')}return false}var b=e.timeStamp-this.scrollStartTime;var c=(2*a/b)/this.friction;var d=(this.friction/2)*(c*c);if(c<0){c=-c;d=-d}var f=this.slotEl[this.activeSlot].slotYPosition+d;if(f>0){f/=2;c/=3;if(f>this.swSlotWrapper.clientHeight/4){f=this.swSlotWrapper.clientHeight/4}}else if(f<this.slotEl[this.activeSlot].slotMaxScroll){f=(f-this.slotEl[this.activeSlot].slotMaxScroll)/2+this.slotEl[this.activeSlot].slotMaxScroll;c/=3;if(f<this.slotEl[this.activeSlot].slotMaxScroll-this.swSlotWrapper.clientHeight/4){f=this.slotEl[this.activeSlot].slotMaxScroll-this.swSlotWrapper.clientHeight/4}}else{f=Math.round(f/this.cellHeight)*this.cellHeight}this.scrollTo(this.activeSlot,Math.round(f),Math.round(c)+'ms');return true},scrollTo:function(a,b,c){this.slotEl[a].style.webkitTransitionDuration=c?c:'100ms';this.setPosition(a,b?b:0);if(this.slotEl[a].slotYPosition>0||this.slotEl[a].slotYPosition<this.slotEl[a].slotMaxScroll){this.slotEl[a].addEventListener('webkitTransitionEnd',this,false)}},scrollToValue:function(a,b){var c,count,i;this.slotEl[a].removeEventListener('webkitTransitionEnd',this,false);this.slotEl[a].style.webkitTransitionDuration='0';count=0;for(i in this.slotData[a].values){if(i==b){c=count*this.cellHeight;this.setPosition(a,c);break}count-=1}},backWithinBoundaries:function(e){e.target.removeEventListener('webkitTransitionEnd',this,false);this.scrollTo(e.target.slotPosition,e.target.slotYPosition>0?0:e.target.slotMaxScroll,'150ms');return false},tapDown:function(e){e.currentTarget.addEventListener('touchmove',this,false);e.currentTarget.addEventListener('touchend',this,false);e.currentTarget.className='sw-pressed'},tapCancel:function(e){e.currentTarget.removeEventListener('touchmove',this,false);e.currentTarget.removeEventListener('touchend',this,false);e.currentTarget.className=''},tapUp:function(e){this.tapCancel(e);if(e.currentTarget.id=='sw-cancel'){this.cancelAction()}else{this.doneAction()}this.close()},setCancelAction:function(a){this.cancelAction=a},setDoneAction:function(a){this.doneAction=a},cancelAction:function(){return false},cancelDone:function(){return true}};